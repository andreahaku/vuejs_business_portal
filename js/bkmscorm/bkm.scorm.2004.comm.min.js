function keepAliveStart(){AppendToLog("keepAliveStart","typeof keepAliveStopped = "+typeof keepAliveStopped),keepAliveStopped||"undefined"!=typeof _keepAliveURL&&"undefined"!=typeof _keepAliveInterval&&(AppendToLog("","_keepAliveURL = "+_keepAliveURL),AppendToLog("","_keepAliveInterval = "+_keepAliveInterval),isNaN(_keepAliveInterval)||Number(_keepAliveInterval)>0&&(keepAliveIntervalMs=Number(_keepAliveInterval)),null!=keepAliveIntervalMs&&""!=_keepAliveURL&&(AppendToLog("","setInterval"),keepAliveIntervalId=window.setInterval("keepAlive()",keepAliveIntervalMs),keepAliveStarted=!0))}function keepAlive(){AppendToLog("keepAlive",""),AppendToLog("","opening connetion, url = "+_keepAliveURL);var t;if(xmlhttpRequestInit(),null!=xmlhttpRequestObj)try{var n=parent.RD3_DesktopManager.MessagePump.CreateXMLDoc("rd3"),r=n.getElementsByTagName("rd3"),a=r[0];a.setAttribute("num",parent.RD3_DesktopManager.MessagePump.RequestNumber),parent.RD3_DesktopManager.MessagePump.RequestNumber++,t="session="+_lmsLearnSessionId+"&command=keepalive";var o;o=n.createElement("cmd"),o.setAttribute("oid","undefinded"),o.setAttribute("obn","SCORM_request&"+t),a.appendChild(o),AppendToLog("","sending XML Data: = "+n),xmlhttpRequestObj.open("POST",_lmsURL,!1),xmlhttpRequestObj.setRequestHeader("Content-Type","text/xml"),xmlhttpRequestObj.send(n)}catch(i){AppendToLog("","error = "+i.toString())}}function keepAliveStop(){AppendToLog("keepAliveStop","keepAliveIntervalId = "+keepAliveIntervalId),keepAliveStarted&&!keepAliveStopped?(AppendToLog("keepAliveStop","stopped"),window.clearInterval(keepAliveIntervalId)):AppendToLog("keepAliveStop","not started or alredy stopped"),keepAliveStopped=!0}function xmlhttpRequestInit(){if(null==xmlhttpRequestObj)if(is_ie6)SetXmlhttpActivXRequestObj(),null==xmlhttpRequestObj&&setCurrentErrorCode("GENERAL_INIT_FAILURE",_nativeErrString);else if(is_ie6up||is_nav6up)try{AppendToLog("","creating XMLHttpRequest object"),xmlhttpRequestObj=new XMLHttpRequest}catch(e){setCurrentErrorCode("GENERAL_INIT_FAILURE",e.toString()),xmlhttpRequestObj=null}else alert("Il browser utilizzato non ï¿½ supportato")}function SetNativeErrString(e){_nativeErrString=e}function sendCommand(e){try{parent.RD3_SendCommand(e)}catch(t){console.log("Error In RD3_SendCommand")}}function readTextFile(e){var t,n=new XMLHttpRequest;return n.open("GET",e,!1),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0==n.status)&&(t=n.responseText)},n.send(null),t}function fillJson(e,t,n){if(wich!=t&&(wich=t,manifest=readTextFile("../SCORM-modules/"+t),null==manifest)){console.log(t),t=t.split("/"),t.splice(1,1);var r=t[0];console.log(t),console.log(r);for(var a=1;a<t.length;a++)console.log("entra"),r+="/",r+=t[a];t=r,manifest=readTextFile("../SCORM-modules/"+t)}var s,i=(manifest.split("<schemaversion>")[1].split("</schemaversion>")[0],Base64.encode(manifest)),l=Base64.encode(getLog()),c=null,u=null,p=null,d=null,m=null;return n["cmi.interactions"]&&(c=n["cmi.interactions"],u=n["cmi.score.max"],p=n["cmi.score.min"],d=n["cmi.score.raw"],m=n["cmi.location"]),s="initialize"===e?{IdTracking:localStorage.getItem("IdTracking"),Command:e,IdPartecipazione:localStorage.getItem("IdPartecipazione"),XMLimsmanifest:i,cmiSuccessStatus:null,cmiLocation:null,cmiCoreLessonLocation:null,cmiSuspendData:null,cmiCompletionStatus:null,cmiScoreRaw:null,cmiScoreMin:null,cmiScoreMax:null,cmiInteractions:null,log:l}:"getsuspenddata"===e||"getcompletionstatus"===e||"getlocation"===e||"getsuccessstatus"===e?{IdTracking:localStorage.getItem("IdTracking"),Command:e,IdPartecipazione:localStorage.getItem("IdPartecipazione"),XMLimsmanifest:null,cmiSuccessStatus:null,cmiLocation:null,cmiCoreLessonLocation:null,cmiSuspendData:null,cmiCompletionStatus:null,cmiScoreRaw:null,cmiScoreMin:null,cmiScoreMax:null,cmiInteractions:null,log:null}:{IdTracking:localStorage.getItem("IdTracking"),Command:e,IdPartecipazione:localStorage.getItem("IdPartecipazione"),XMLimsmanifest:i,cmiSuccessStatus:filterU(LMSGetValue("cmi.success_status")),cmiLocation:m,cmiCoreLessonLocation:filterU(getCacheValue("cmi.core.lesson_location")),cmiSuspendData:filterU(getCacheValue("cmi.suspend_data")),cmiCompletionStatus:filterU(LMSGetValue("cmi.completion_status")),cmiScoreRaw:d,cmiScoreMin:p,cmiScoreMax:u,cmiInteractions:c,log:l}}function filterU(e){return void 0===e?null:e}function xmlhttpRequest(e,t){var n="",r=localStorage.getItem("ManifestPath"),a=fillJson(e,r,t),o=localStorage.getItem("path")+"/Webapi",i=new XMLHttpRequest;if(i.open("POST",o,!1),i.setRequestHeader("X-HTTP-Method-Override","SCORMRequest"),i.setRequestHeader("token",localStorage.getItem("al_token")),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Access-Control-Allow-Origin","*://*/*"),i.send(JSON.stringify(a)),200===i.status){if(n=i.responseText,n=JSON.parse(i.responseText),null!=n.Response.Messaggio&&""!=n.Response.Messaggio)if(console.log(n.Response.Messaggio),null!=localStorage.getItem("leaving")&&localStorage.getItem("leaving")!=location.href.split("#!/")[1].split("/")[1]);else try{var l=new CustomEvent("notYet",{detail:{custom_mess:n.Response.Messaggio}});document.dispatchEvent(l)}catch(s){var l=document.createEvent("CustomEvent");l.initCustomEvent("notYet",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.dispatchEvent(l)}return localStorage.removeItem("leaving"),n=n.Response.Result,unescape(n)}return unescape(!1)}function URLEncode(e){return e=new String(e),e=escape(e),e=e.replace(/\+/g,"%2B"),e=e.replace(/%20/g,"+"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\//g,"%2F"),e=e.replace(/@/g,"%40")}var xmlhttpRequestObj=null,keepAliveStarted=!1,keepAliveStopped=!1,keepAliveIntervalMs=null,keepAliveIntervalId=null,_nativeErrString="",wich=null,manifest=null,Base64=function(){"use strict";var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(e){var n,r,t="";for(e=e.replace(/\r\n/g,"\n"),r=0;r<e.length;r++)n=e.charCodeAt(r),128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128));return t},n=function(e){for(var t="",n=0,r=0,a=0,o=0;n<e.length;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(a=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&a),n+=2):(a=e.charCodeAt(n+1),o=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&o),n+=3);return t},r=function(e){var n,t="";for(n=0;n<e.length;n++)t+=e.charCodeAt(n).toString(16);return t},a=function(e){var n,t="";for(e.length%2>0&&(e="0"+e),n=0;n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.charAt(n)+e.charAt(n+1),16));return t},o=function(n){var a,o,i,l,s,c,u,r="",p=0;for(n=t(n);p<n.length;)a=n.charCodeAt(p++),o=n.charCodeAt(p++),i=n.charCodeAt(p++),l=a>>2,s=(3&a)<<4|o>>4,c=(15&o)<<2|i>>6,u=63&i,isNaN(o)?c=u=64:isNaN(i)&&(u=64),r+=e.charAt(l),r+=e.charAt(s),r+=e.charAt(c),r+=e.charAt(u);return r},i=function(t){var a,o,i,l,s,c,u,r="",p=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<t.length;)l=e.indexOf(t.charAt(p++)),s=e.indexOf(t.charAt(p++)),c=e.indexOf(t.charAt(p++)),u=e.indexOf(t.charAt(p++)),a=l<<2|s>>4,o=(15&s)<<4|c>>2,i=(3&c)<<6|u,r+=String.fromCharCode(a),64!==c&&(r+=String.fromCharCode(o)),64!==u&&(r+=String.fromCharCode(i));return n(r)},l=function(e){return r(i(e))},s=function(e){return o(a(e))};return{encode:o,decode:i,decodeToHex:l,encodeFromHex:s}}();